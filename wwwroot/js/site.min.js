function write(n){var t=document.createElement("p");t.innerHTML=n;output.appendChild(t)}function doConnect(){socket=new WebSocket(uri);socket.onopen=function(){write("opened "+uri);doSend()};socket.onclose=function(){write("closed")};socket.onmessage=function(n){write("Received: "+n.data);$("#chat").val("")};socket.onerror=function(n){write("Error: "+n.data)};socket.channel=1;$("#chat").keypress(function(n){var t=$(this);n.keyCode=="13"&&(text=t.val(),doSend())})}function doSend(){write("Sending: "+text);socket.send(text)}function onInit(){output=document.getElementById("output");doConnect()}var socket,uri="ws://"+window.location.host+"/ws",output,text="test echo";window.onload=onInit;